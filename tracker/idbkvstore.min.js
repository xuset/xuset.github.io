(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var r;if(typeof window!=="undefined"){r=window}else if(typeof global!=="undefined"){r=global}else if(typeof self!=="undefined"){r=self}else{r=this}r.IdbKvStore=e()}})(function(){var e,r,o;return function e(r,o,n){function t(i,u){if(!o[i]){if(!r[i]){var c=typeof require=="function"&&require;if(!u&&c)return c(i,!0);if(s)return s(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var f=o[i]={exports:{}};r[i][0].call(f.exports,function(e){var o=r[i][1][e];return t(o?o:e)},f,f.exports,e,r,o,n)}return o[i].exports}var s=typeof require=="function"&&require;for(var i=0;i<n.length;i++)t(n[i]);return t}({"/":[function(e,r,o){r.exports=s;var n=typeof window==="undefined"?self:window;var t=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB;function s(e,r){var o=this;if(typeof e!=="string")throw new Error("A name must be supplied of type string");if(!t)throw new Error("IndexedDb not supported");if(!(this instanceof s))return new s(e,r);o._db=null;o._closed=false;o._queue=[];var n=t.open(e);n.onerror=i;n.onsuccess=c;n.onupgradeneeded=a;function i(e){o.close();u(e,r)}function c(e){if(o._closed){e.target.result.close()}else{o._db=e.target.result;o._db.onclose=f;o._drainQueue();if(r)r(null)}}function a(e){if(o._closed)return;var r=e.target.result;r.createObjectStore("kv")}function f(){o.close()}}s.prototype.get=function(e,r){var o=this;if(o._closed)throw new Error("Database is closed");var n=i(r);if(!o._db){o._queue.push([o.get,e,n.cb])}else if(Array.isArray(e)){var t=[];var s=false;var c=0;e.forEach(function(r,i){o.get(e[i],function(r,o){if(s)return;if(r){s=true;n.cb(r)}t[i]=o;c++;if(c===e.length)n.cb(null,t)})})}else{var a=o._db.transaction("kv","readonly");var f=a.objectStore("kv").get(e);f.onsuccess=function(e){n.cb(null,e.target.result)};a.onerror=function(e){u(e,n.cb)}}return n.promise};s.prototype.set=function(e,r,o){var n=this;if(n._closed)throw new Error("Database is closed");var t=i(o);if(!n._db){n._queue.push([n.set,e,r,t.cb])}else{var s=n._db.transaction("kv","readwrite");var c=s.objectStore("kv").put(r,e);c.onsuccess=function(){t.cb(null)};s.onerror=function(e){u(e,t.cb)}}return t.promise};s.prototype.json=function(e){var r=this;if(r._closed)throw new Error("Database is closed");var o=i(e);if(!r._db){r._queue.push([r.json,o.cb])}else{var n=r._db.transaction("kv","readonly");var t=n.objectStore("kv").openCursor();var s={};t.onsuccess=function(e){var r=e.target.result;if(r){s[r.key]=r.value;r.continue()}else{o.cb(null,s)}};n.onerror=function(e){u(e,o.cb)}}return o.promise};s.prototype.keys=function(e){var r=this;if(r._closed)throw new Error("Database is closed");var o=i(e);if(!r._db){r._queue.push([r.keys,o.cb])}else{var n=r._db.transaction("kv","readonly");var t=n.objectStore("kv").openCursor();var s=[];t.onsuccess=function(e){var r=e.target.result;if(r){s.push(r.key);r.continue()}else{o.cb(null,s)}};n.onerror=function(e){u(e,o.cb)}}return o.promise};s.prototype.remove=function(e,r){var o=this;if(o._closed)throw new Error("Database is closed");var n=i(r);if(!o._db){o._queue.push([o.remove,e,n.cb])}else{var t=o._db.transaction("kv","readwrite");var s=t.objectStore("kv").delete(e);s.onsuccess=function(e){n.cb(null)};t.onerror=function(e){u(e,n.cb)}}return n.promise};s.prototype.clear=function(e){var r=this;if(r._closed)throw new Error("Database is closed");var o=i(e);if(!r._db){r._queue.push([r.clear,o.cb])}else{var n=r._db.transaction("kv","readwrite");var t=n.objectStore("kv").clear();t.onsuccess=function(e){o.cb(null)};n.onerror=function(e){u(e,o.cb)}}return o.promise};s.prototype.count=function(e){var r=this;if(r._closed)throw new Error("Database is closed");var o=i(e);if(!r._db){r._queue.push([r.count,o.cb])}else{var n=r._db.transaction("kv","readonly");var t=n.objectStore("kv").count();t.onsuccess=function(e){o.cb(null,e.target.result)};n.onerror=function(e){u(e,o.cb)}}return o.promise};s.prototype.add=function(e,r,o){var n=this;if(n._closed)throw new Error("Database is closed");var t=i(o);if(!n._db){n._queue.push([n.add,e,r,t.cb])}else{var s=n._db.transaction("kv","readwrite");var c=s.objectStore("kv").add(r,e);c.onsuccess=function(e){t.cb(null)};s.onerror=function(e){u(e,t.cb)}}return t.promise};s.prototype.close=function(){if(this._closed)return;this._closed=true;if(this._db)this._db.close();this._queue=null};s.prototype._drainQueue=function(){var e=this;for(var r=0;r<e._queue.length;r++){var o=e._queue[r];var n=o.splice(1);o[0].apply(e,n)}e._queue=null};function i(e){var r={cb:e};if(typeof Promise==="function"&&e==null){r.promise=new Promise(function(e,o){r.cb=function(r,n){if(r)return o(r);else return e(n)}})}if(!r.cb)r.cb=function e(){};return r}function u(e,r){var o=new Error("IDB error");o.event=e;if(r){r(o)}else{throw o}}},{}]},{},[])("/")});
